"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[5865],{3905:function(e,a,n){n.d(a,{Zo:function(){return p},kt:function(){return g}});var t=n(7294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function s(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?s(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},s=Object.keys(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=t.createContext({}),c=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):o(o({},a),e)),n},p=function(e){var a=c(e.components);return t.createElement(i.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},d=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),g=r,u=d["".concat(i,".").concat(g)]||d[g]||m[g]||s;return n?t.createElement(u,o(o({ref:a},p),{},{components:n})):t.createElement(u,o({ref:a},p))}));function g(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<s;c++)o[c]=n[c];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9415:function(e,a,n){n.r(a),n.d(a,{assets:function(){return p},contentTitle:function(){return i},default:function(){return g},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return m}});var t=n(7462),r=n(3366),s=(n(7294),n(3905)),o=["components"],l={sidebar_position:3,sidebar_label:"Examples"},i="Examples",c={unversionedId:"api/examples",id:"api/examples",title:"Examples",description:"Here are small code snippets in a question-answer format for start to interact with the main Gear component.",source:"@site/docs/api/examples.md",sourceDirName:"api",slug:"/api/examples",permalink:"/api/examples",editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/api/examples.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Examples"},sidebar:"tutorialSidebar",previous:{title:"Connect",permalink:"/api/connect"},next:{title:"Web3",permalink:"/general/web3"}},p={},m=[{value:"Encode / decode payloads",id:"encode--decode-payloads",level:3},{value:"Getting metadata",id:"getting-metadata",level:3},{value:"Sign messages",id:"sign-messages",level:3},{value:"Upload program",id:"upload-program",level:3},{value:"Send message",id:"send-message",level:3},{value:"Send reply message",id:"send-reply-message",level:3},{value:"Submit code",id:"submit-code",level:3},{value:"Get gasSpent",id:"get-gasspent",level:3},{value:"For init message",id:"for-init-message",level:4},{value:"For handle message",id:"for-handle-message",level:4},{value:"For reply message",id:"for-reply-message",level:4},{value:"Read state of program",id:"read-state-of-program",level:3},{value:"Mailbox",id:"mailbox",level:3},{value:"Read",id:"read",level:4},{value:"Subscribe to mailbox changes",id:"subscribe-to-mailbox-changes",level:4},{value:"Subscribe to events",id:"subscribe-to-events",level:3},{value:"Get block data",id:"get-block-data",level:3},{value:"Get block timestamp",id:"get-block-timestamp",level:3},{value:"Get blockHash by block number",id:"get-blockhash-by-block-number",level:3},{value:"Get block number by blockhash",id:"get-block-number-by-blockhash",level:3},{value:"Get all block&#39;s events",id:"get-all-blocks-events",level:3},{value:"Get all block&#39;s extrinsics",id:"get-all-blocks-extrinsics",level:3},{value:"Create keyring",id:"create-keyring",level:3}],d={toc:m};function g(e){var a=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,t.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"examples"},"Examples"),(0,s.kt)("p",null,"Here are small code snippets in a question-answer format for start to interact with the main Gear component."),(0,s.kt)("h3",{id:"encode--decode-payloads"},"Encode / decode payloads"),(0,s.kt)("p",null,"Encode and decode data"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { CreateType } from '@gear-js/api';\n\n// If \"TypeName\" alredy registred\nconst result = CreateType.create('TypeName', somePayload);\n// Otherwise need to add metadata containing TypeName and all required types\nconst result = CreateType.create('TypeName', somePayload, metadata);\n")),(0,s.kt)("p",null,"Result of this functions is data of type ",(0,s.kt)("inlineCode",{parentName:"p"},"Codec")," and it has the next methods"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"result.toHex(); // - returns a hex represetation of the value\nresult.toHuman(); // - returns human friendly object representation of the value\nresult.toString(); //  - returns a string represetation of the value\nresult.toU8a(); // - encodes the value as a Unit8Array\nresult.toJSON(); // - converts the value to JSON\n")),(0,s.kt)("h3",{id:"getting-metadata"},"Getting metadata"),(0,s.kt)("p",null,"Getting metadata from program.meta.wasm"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getWasmMetadata } from '@gear-js/api';\nconst fileBuffer = fs.readFileSync('path/to/program.meta.wasm');\nconst meta = await getWasmMetadata(fileBuffer);\n")),(0,s.kt)("h3",{id:"sign-messages"},"Sign messages"),(0,s.kt)("p",null,"Creating signature"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { GearKeyring } from '@gear-js/api';\nconst message = 'your message';\nconst signature = GearKeyring.sign(keyring, message);\n\n// Check signature\nconst publicKey = keyring.address;\nconst verified = GearKeyring.checkSign(publicKey, signature, message);\n")),(0,s.kt)("h3",{id:"upload-program"},"Upload program"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const code = fs.readFileSync('path/to/program.wasm');\n\nconst program = {\n  code,\n  gasLimit: 1000000,\n  value: 1000,\n  initPayload: somePayload,\n};\n\ntry {\n  const { programId, salt } = await gearApi.program.submit(uploadProgram, meta);\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\n\ntry {\n  await gearApi.program.signAndSend(keyring, (event) => {\n    console.log(event.toHuman());\n  });\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\n")),(0,s.kt)("h3",{id:"send-message"},"Send message"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"try {\n  const message = {\n    destination: destination, // programId\n    payload: somePayload,\n    gasLimit: 10000000,\n    value: 1000,\n  };\n  // In that case payload will be encoded using meta.handle_input type\n  await gearApi.message.submit(message, meta);\n  // So if you want to use another type you can specify it\n  await gearApi.message.submit(message, meta, meta.async_handle_input); // For example\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\ntry {\n  await gearApi.message.signAndSend(keyring, (event) => {\n    console.log(event.toHuman());\n  });\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\n")),(0,s.kt)("h3",{id:"send-reply-message"},"Send reply message"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"try {\n  const reply = {\n    toId: messageId,\n    payload: somePayload,\n    gasLimit: 10000000,\n    value: 1000,\n  };\n  // In that case payload will be encoded using meta.async_handle_input type\n  await gearApi.reply.submit(reply, meta);\n  // So if you want to use another type you can specify it\n  await gearApi.reply.submit(reply, meta, meta.async_init_input);\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\ntry {\n  await gearApi.reply.signAndSend(keyring, (events) => {\n    console.log(event.toHuman());\n  });\n} catch (error) {\n  console.error(`${error.name}: ${error.message}`);\n}\n")),(0,s.kt)("h3",{id:"submit-code"},"Submit code"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const code = fs.readFileSync('path/to/program.opt.wasm');\nconst codeHash = gearApi.code.submit(code);\ngearApi.code.signAndSend(alice, () => {\n  events.forEach(({ event: { method, data } }) => {\n    if (method === 'ExtrinsicFailed') {\n      throw new Error(data.toString());\n    } else if (method === 'CodeSaved') {\n      console.log(data.toHuman());\n    }\n  });\n});\n")),(0,s.kt)("h3",{id:"get-gasspent"},"Get gasSpent"),(0,s.kt)("h4",{id:"for-init-message"},"For init message"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const code = fs.readFileSync('demo_ping.opt.wasm');\nconst gas = await gearApi.program.gasSpent.init(\n  '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d', // source id\n  code,\n  '0x00',\n);\nconsole.log(gas.toHuman());\n")),(0,s.kt)("h4",{id:"for-handle-message"},"For handle message"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const code = fs.readFileSync('demo_meta.opt.wasm');\nconst meta = await getWasmMetadata(fs.readFileSync('demo_meta.opt.wasm'));\nconst gas = await gearApi.program.gasSpent.handle(\n  '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d',\n  '0xa178362715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d', //program id\n  {\n    id: {\n      decimal: 64,\n      hex: '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d',\n    },\n  },\n  meta,\n);\nconsole.log(gas.toHuman());\n")),(0,s.kt)("h4",{id:"for-reply-message"},"For reply message"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const code = fs.readFileSync('demo_async.opt.wasm');\nconst meta = await getWasmMetadata(fs.readFileSync('demo_async.opt.wasm'));\nconst gas = await gearApi.program.gasSpent.reply(\n  '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d',\n  '0x518e6bc03d274aadb3454f566f634bc2b6aef9ae6faeb832c18ae8300fd72635', // message id\n  0, // exit code\n  'PONG',\n  meta,\n);\nconsole.log(gas.toHuman());\n")),(0,s.kt)("h3",{id:"read-state-of-program"},"Read state of program"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const metaWasm = fs.readFileSync('path/to/meta.wasm');\nconst state = gearApi.programState.read(programId, metaWasm);\n// If program expects inputValue in meta_state function it's possible to specify it\nconst state = gearApi.programState.read(programId, metaWasm, inputValue);\n")),(0,s.kt)("h3",{id:"mailbox"},"Mailbox"),(0,s.kt)("h4",{id:"read"},"Read"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const api = await GearApi.create();\nconst mailbox = await api.mailbox.read('5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY');\nconsole.log(mailbox.toHuman());\n")),(0,s.kt)("h4",{id:"subscribe-to-mailbox-changes"},"Subscribe to mailbox changes"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.mailbox.subscribe(\n  '0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d',\n  (data) => {\n    console.log(data.toHuman());\n  },\n);\n")),(0,s.kt)("h3",{id:"subscribe-to-events"},"Subscribe to events"),(0,s.kt)("p",null,"Subscribe to all events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.allEvents((events) => {\n  console.log(event.toHuman());\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("p",null,"Check what the event is"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"gearApi.allEvents((events) => {\n  events\n    .filter(({ event }) => gearApi.events.gear.InitMessageEnqueued.is(event))\n    .forEach(({ event: { data } }) => {\n      console.log(data.toHuman());\n    });\n\n  events\n    .filter(({ event }) => gearApi.events.balances.Transfer.is(event))\n    .forEach(({ event: { data } }) => {\n      console.log(data.toHuman());\n    });\n});\n")),(0,s.kt)("p",null,"Subscribe to Log events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeLogEvents(({ data: { id, source, dest, payload, reply } }) => {\n  console.log(`\n  logId: ${id.toHex()}\n  source: ${source.toHex()}\n  payload: ${payload.toHuman()}\n  `);\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("p",null,"Subscribe to Program events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeProgramEvents(({ method, data: { info, reason } }) => {\n  console.log(method);\n  console.log(`ProgramId: ${info.programId}`);\n  reason && console.log(`Reason: ${reason.toHuman()}`);\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("p",null,"Subscribe to Transfer events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeTransferEvents(({ data: { from, to, value } }) => {\n  console.log(`\n    Transfer balance:\n    from: ${from.toHex()}\n    to: ${to.toHex()}\n    value: ${+value.toString()}\n    `);\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("p",null,"Subscribe to new blocks"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeToNewBlocks((header) => {\n  console.log(`New block with number: ${header.number.toNumber()} and hash: ${header.hash.toHex()}`);\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("h3",{id:"get-block-data"},"Get block data"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const data = await gearApi.blocks.get(blockNumberOrBlockHash);\nconsole.log(data.toHuman());\n")),(0,s.kt)("h3",{id:"get-block-timestamp"},"Get block timestamp"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const ts = await gearApi.blocks.getBlockTimestamp(blockNumberOrBlockHash);\nconsole.log(ts.toNumber());\n")),(0,s.kt)("h3",{id:"get-blockhash-by-block-number"},"Get blockHash by block number"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const hash = await gearApi.blocks.getBlockHash(blockNumber);\nconsole.log(hash.toHex());\n")),(0,s.kt)("h3",{id:"get-block-number-by-blockhash"},"Get block number by blockhash"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const hash = await gearApi.blocks.getBlockNumber(blockHash);\nconsole.log(hash.toNumber());\n")),(0,s.kt)("h3",{id:"get-all-blocks-events"},"Get all block's events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const events = await gearApi.blocks.getEvents(blockHash);\nevents.forEach((event) => {\n  console.log(event.toHuman());\n});\n")),(0,s.kt)("h3",{id:"get-all-blocks-extrinsics"},"Get all block's extrinsics"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const extrinsics = await gearApi.blocks.getExtrinsics(blockHash);\nextrinsics.forEach((extrinsic) => {\n  console.log(extrinsic.toHuman());\n});\n")),(0,s.kt)("h3",{id:"create-keyring"},"Create keyring"),(0,s.kt)("p",null,"Creating a new keyring"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { GearKeyring } from '@gear-js/api';\nconst { keyring, json } = await GearKeyring.create('keyringName', 'passphrase');\n")),(0,s.kt)("p",null,"Getting a keyring from JSON"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const jsonKeyring = fs.readFileSync('path/to/keyring.json').toString();\nconst keyring = GearKeyring.fromJson(jsonKeyring, 'passphrase');\n")),(0,s.kt)("p",null,"Getting JSON for keyring"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const json = GearKeyring.toJson(keyring, 'passphrase');\n")),(0,s.kt)("p",null,"Getting a keyring from seed"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const seed = '0x496f9222372eca011351630ad276c7d44768a593cecea73685299e06acef8c0a';\nconst keyring = await GearKeyring.fromSeed(seed, 'name');\n")),(0,s.kt)("p",null,"Getting a keyring from mnemonic"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const mnemonic = 'slim potato consider exchange shiver bitter drop carpet helmet unfair cotton eagle';\nconst keyring = GearKeyring.fromMnemonic(mnemonic, 'name');\n")),(0,s.kt)("p",null,"Generate mnemonic and seed"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const { mnemonic, seed } = GearKeyring.generateMnemonic();\n\n// Getting a seed from mnemonic\nconst { seed } = GearKeyring.generateSeed(mnemonic);\n")))}g.isMDXComponent=!0}}]);